/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'Mr.SAY SEAK LENG' at '7/30/16 12:00 PM' with Gradle 2.14
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/2.14/userguide/tutorial_java_projects.html
 */


buildscript {
	repositories {
        mavenCentral()
        maven { url 'http://repo.spring.io/plugins-release' }
    }
    dependencies {
        classpath('org.springframework.boot:spring-boot-gradle-plugin:1.4.0.RELEASE')
        
        // Provides additional optional and provided dependency configurations for Gradle along with Maven POM generation 
        // https://github.com/spring-projects/gradle-plugins/tree/master/propdeps-plugin
        classpath('org.springframework.build.gradle:propdeps-plugin:0.0.7')
    }
}

// Apply the java plugin to add support for Java
apply plugin: 'java'

apply plugin: 'spring-boot'

sourceCompatibility = 1.8
targetCompatibility = 1.8

configure(allprojects) {
    apply plugin: 'propdeps'
    apply plugin: 'propdeps-maven'
    apply plugin: 'propdeps-idea'
    apply plugin: 'propdeps-eclipse'
}

// In this section you declare where to find the dependencies of your project
repositories {
    jcenter()
}

ext {
	thymeleafVersion = '3.0.1.RELEASE'
}

// In this section you declare the dependencies for your production and test code
dependencies {
    
    /*compile('org.springframework.boot:spring-boot-starter-web') {
    	exclude module: 'spring-boot-starter-tomcat'
    	exclude module: 'org.apache.tomcat.embed'
    } */
    
    compile 'org.springframework.boot:spring-boot-starter-undertow'
    // to support http2 
    compile 'org.mortbay.jetty.alpn:alpn-boot:8.1.9.v20160720'
    
    compile('org.springframework.boot:spring-boot-starter-thymeleaf') {
    	exclude module: 'spring-boot-starter-tomcat'
    	exclude module: 'org.apache.tomcat.embed'
    }
    
    // upgrade thymeleaf
    compile "org.thymeleaf:thymeleaf-spring4:${thymeleafVersion}"
    compile "org.thymeleaf:thymeleaf:${thymeleafVersion}"
    compile 'nz.net.ultraq.thymeleaf:thymeleaf-layout-dialect:2.0.1'
    
    optional 'org.springframework.boot:spring-boot-devtools'
    
    testCompile('org.springframework.boot:spring-boot-starter-test')
}

bootRepackage {
    mainClass = 'com.kdemo.springboot.app.Application'
    excludeDevtools = true
}


task copyFiles{
	copy{
		from ('src/main/resources/h2'){
			include '*.jar'
			include '*.bat'
		}
		into 'build/libs'
	}
}

// use spring gradle to run project
bootRun {
   jvmArgs = [ "-Xbootclasspath/p:src/main/resources/h2/alpn-boot-8.1.9.v20160720.jar"]
}